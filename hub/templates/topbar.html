{{ define "topbar" }}
<nav class="navbar">
    <div class="container">
        <a href="/" class="nav-brand" style="text-decoration: none; display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <img src="/static/logo.png" alt="Qube Logo" width="28" height="28">
            <span>QubeCloud</span>
        </a>
        <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="nav-menu">
            <a href="/" class="nav-link">Home</a>
            <a href="/explore" class="nav-link">Explore</a>
            <div class="nav-auth" id="navAuth">
                <a href="/login" class="nav-link">Login</a>
                <a href="/signup" class="btn-primary">Get Started</a>
            </div>
            <div class="nav-user" id="navUser" style="display: none;">
                <button id="uploadBtn" class="btn-primary-sm">+ Upload</button>
                <div class="user-profile-menu">
                    <button id="profileMenuBtn" class="profile-btn">
                        <img id="navAvatar" src="/static/img/avatar-default.svg" alt="Avatar" width="24" height="24" style="border-radius:50%" onerror="this.src='/static/img/avatar-default.svg'" />
                    </button>
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="profile-info">
                            <p id="profileUsername" class="profile-name">User</p>
                            <p id="profileEmail" class="profile-email">user@example.com</p>
                        </div>
                        <hr>
                        <a href="/profile" class="dropdown-item">My Images</a>
                        <a href="/settings" class="dropdown-item">Settings</a>
                        <hr>
                        <a href="#" id="logoutBtn" class="dropdown-item danger">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>
<script>
// Populate navbar user info once per page
(async function(){
    try {
        const token = localStorage.getItem('token');
        if (!token) return;
        const res = await fetch('/api/auth/profile', { headers: { Authorization: `Bearer ${token}` }});
        if (!res.ok) return;
        const u = await res.json();
        const avatar = document.getElementById('navAvatar');
        if (avatar && u.id) { avatar.src = `/static/avatars/${u.id}.png`; }
        const uname = document.getElementById('profileUsername');
        const uemail = document.getElementById('profileEmail');
        if (uname) uname.textContent = u.username || 'User';
        if (uemail) uemail.textContent = u.email || '';
    } catch {}
})();
</script>
{{ end }}
